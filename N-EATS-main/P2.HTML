<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>N-Eats | Hostel Mess Reservation</title>
Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script src="https://unpkg.com/lucide@latest"></script>
Â  Â  Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
Â  Â  <script>
Â  Â  Â  Â  tailwind.config = {
Â  Â  Â  Â  Â  Â  theme: {
Â  Â  Â  Â  Â  Â  Â  Â  extend: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colors: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'neats-primary': '#10b981', // Emerald Green
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'neats-secondary': '#fbbf24', // Amber Yellow
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  'neats-bg': '#f3f4f6', // Light Gray
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fontFamily: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  sans: ['Inter', 'sans-serif'],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  keyframes: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pop: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '0%, 100%': { transform: 'scale(1)' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '50%': { transform: 'scale(1.05)' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flash: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '0%': { backgroundColor: '#10b98150' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  '100%': { backgroundColor: 'white' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  animation: {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  pop: 'pop 0.3s ease-in-out',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  flash: 'flash 0.5s ease-out',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  </script>
Â  Â  <style>
Â  Â  Â  Â  /* Custom Scrollbar for a cleaner look */
Â  Â  Â  Â  ::-webkit-scrollbar {
Â  Â  Â  Â  Â  Â  width: 8px;
Â  Â  Â  Â  }
Â  Â  Â  Â  ::-webkit-scrollbar-track {
Â  Â  Â  Â  Â  Â  background: #e5e7eb;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  ::-webkit-scrollbar-thumb {
Â  Â  Â  Â  Â  Â  background: #9ca3af;
Â  Â  Â  Â  Â  Â  border-radius: 10px;
Â  Â  Â  Â  }
Â  Â  Â  Â  ::-webkit-scrollbar-thumb:hover {
Â  Â  Â  Â  Â  Â  background: #6b7280;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Subtle Aesthetic Background */
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  background-color: #f3f4f6;
Â  Â  Â  Â  Â  Â  background-image: radial-gradient(#d1d5db 0.5px, transparent 0.5px);
Â  Â  Â  Â  Â  Â  background-size: 10px 10px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Active navigation button styling */
Â  Â  Â  Â  /* JS now manages text color, this focuses on background/shadow */
Â  Â  Â  Â  .active-tab {
Â  Â  Â  Â  Â  Â  background-color: var(--tw-colors-neats-primary);
Â  Â  Â  Â  Â  Â  box-shadow: 0 6px 10px -3px rgba(16, 185, 129, 0.4);
Â  Â  Â  Â  }
Â  Â  Â  Â  .nav-button {
Â  Â  Â  Â  Â  Â  /* Add base transition for the new hover effect */
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease-in-out; 
Â  Â  Â  Â  }
Â  Â  Â  Â  .nav-button:hover:not(.active-tab) {
Â  Â  Â  Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body class="bg-neats-bg font-sans min-h-screen flex flex-col">

Â  Â  <div id="app" class="flex-grow flex flex-col md:flex-row max-w-7xl mx-auto w-full p-0 md:p-4">

        <nav id="sidebar" class="bg-white shadow-xl md:rounded-3xl md:w-72 flex flex-row md:flex-col justify-around md:justify-start p-3 md:p-6 mb-4 md:mb-0 md:mr-6 fixed bottom-0 left-0 w-full z-10 md:static md:bottom-auto">
            <h1 class="hidden md:block text-3xl font-black text-neats-primary mb-8 border-b-2 border-neats-secondary pb-4 tracking-wider whitespace-nowrap text-center">ğŸœ N-Eats</h1>

            <ul class="flex flex-row md:flex-col space-x-3 md:space-x-0 md:space-y-4 w-full">
                <li class="w-1/4 md:w-full">
                    <button data-tab="home" class="nav-button flex items-center justify-center md:justify-start w-full p-4 rounded-xl transition-all duration-300 text-white bg-neats-primary active-tab shadow-neats-primary/40 hover:scale-[1.02]">
                        <i data-lucide="home" class="w-6 h-6 mr-0 md:mr-4"></i>
                        <span class="text-xs md:text-base font-semibold hidden md:block">Home</span>
                    </button>
                </li>
                <li class="w-1/4 md:w-full">
                    <button data-tab="menu" class="nav-button flex items-center justify-center md:justify-start w-full p-4 rounded-xl transition-all duration-300 text-gray-600 hover:bg-neats-secondary/20 hover:scale-[1.02]">
                        <i data-lucide="utensils" class="w-6 h-6 mr-0 md:mr-4"></i>
                        <span class="text-xs md:text-base font-semibold hidden md:block">Food Menu</span>
                    </button>
                </li>
                <li class="w-1/4 md:w-full">
                    <button data-tab="reserve" class="nav-button flex items-center justify-center md:justify-start w-full p-4 rounded-xl transition-all duration-300 text-gray-600 hover:bg-neats-secondary/20 hover:scale-[1.02]">
                        <i data-lucide="ticket" class="w-6 h-6 mr-0 md:mr-4"></i>
                        <span class="text-xs md:text-base font-semibold hidden md:block">Reserve</span>
                    </button>
                </li>
                <li class="w-1/4 md:w-full">
                    <button data-tab="user-info" class="nav-button flex items-center justify-center md:justify-start w-full p-4 rounded-xl transition-all duration-300 text-gray-600 hover:bg-neats-secondary/20 hover:scale-[1.02]">
                        <i data-lucide="user" class="w-6 h-6 mr-0 md:mr-4"></i>
                        <span class="text-xs md:text-base font-semibold hidden md:block">User Info</span>
                    </button>
                </li>
            </ul>
        </nav>Â  Â  Â  Â  <main id="content-area" class="flex-grow bg-white shadow-xl md:rounded-3xl p-4 md:p-10 mt-16 md:mt-0 mb-20 md:mb-0 overflow-y-auto">
Â  Â  Â  Â  Â  Â  <div id="loading-spinner" class="absolute inset-0 bg-white bg-opacity-95 flex items-center justify-center z-20 hidden md:rounded-3xl">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="chef-hat" class="w-16 h-16 text-neats-primary animate-bounce"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="mt-4 text-neats-primary font-semibold animate-pulse">Whipping up your N-Eats...</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <div id="error-message" class="text-center text-red-500 font-medium py-4 hidden"></div>

Â  Â  Â  Â  Â  Â  <section id="home-tab" class="tab-content">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-4xl md:text-5xl font-extrabold text-neats-primary mb-6 animate-pop">ğŸ˜‹ Eat Smart, Not Hard!</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-xl text-gray-600 mb-10 border-l-4 border-neats-secondary pl-4 font-medium">Your simple, delicious, and friendly mess reservation system.</p>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div id="scan-go-card" data-target-tab="scan-go" class="bg-neats-secondary/10 p-6 rounded-2xl shadow-lg border-t-8 border-neats-secondary transition-all duration-300 hover:shadow-2xl hover:scale-[1.03] hover:rotate-1 cursor-pointer">
                        <i data-lucide="scan" class="w-10 h-10 text-neats-secondary mb-3"></i>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Scan & Go</h3>
                        <p class="text-gray-600">Reserve your meal with one tap and get a unique ticket code for fast access.</p>
                    </div>

                    <div id="zero-waste-card" data-target-tab="zero-waste" class="bg-neats-primary/10 p-6 rounded-2xl shadow-lg border-t-8 border-neats-primary transition-all duration-300 hover:shadow-2xl hover:scale-[1.03] hover:-rotate-1 cursor-pointer">
                        <i data-lucide="award" class="w-10 h-10 text-neats-primary mb-3"></i>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Zero Waste</h3>
                        <p class="text-gray-600">Help the mess reduce food waste by only booking what you plan to eat.</p>
                    </div>

                    <div class="bg-gray-100 p-6 rounded-2xl shadow-lg border-t-8 border-gray-400 transition-all duration-300 hover:shadow-2xl hover:scale-[1.03] hover:translate-y-[-5px]">
                        <i data-lucide="chef-hat" class="w-10 h-10 text-gray-500 mb-3"></i>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Chef's Special</h3>
                        <p class="text-gray-600">Always check the menu for special items before making your final decision!(check this on weekends)</p>
                    </div>
                </div>Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-12 p-8 bg-neats-primary text-white rounded-3xl shadow-2xl flex items-start space-x-4 border-4 border-neats-secondary animate-pop">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="alert-triangle" class="w-8 h-8 flex-shrink-0"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold mb-3">Reservation Deadline Notice</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-lg">Reservations close at **11 AM** for Lunch and **8 PM** for Dinner. Don't miss out!</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </section>
            
            <section id="zero-waste-tab" class="tab-content hidden">
                <h2 class="text-4xl font-bold text-neats-primary mb-8 border-b-4 border-neats-secondary pb-3">ğŸ… Our Zero Waste Commitment</h2>

                <div class="p-8 bg-green-50/50 rounded-3xl shadow-xl border-4 border-neats-primary animate-flash">
                    <h3 class="text-3xl font-extrabold text-neats-primary mb-4 flex items-center">
                        <i data-lucide="leaf" class="w-8 h-8 mr-3"></i> Today's Waste Report:
                    </h3>
                    <p class="text-xl text-gray-700 leading-relaxed font-medium">
                        "Today, **80% of food has been consumed**, and the other **20%** was donated to the old age home nearby college."
                    </p>
                </div>
                
                <p class="mt-8 text-lg text-gray-600">Thank you for helping us achieve zero waste through smart reservation!</p>

                <div class="mt-10 max-w-sm">
                    <button id="zero-waste-back-btn" data-tab="home" class="w-full bg-gray-200 text-gray-700 font-semibold py-3 rounded-xl hover:bg-gray-300 transition-colors shadow-md hover:shadow-lg hover:scale-[1.01]">
                        â† Back to Home
                    </button>
                </div>
            </section>
            
            Â  Â  Â  Â  Â  Â  <section id="scan-go-tab" class="tab-content hidden flex flex-col items-center justify-center min-h-[70vh]">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white p-6 rounded-2xl shadow-lg border-t-8 border-neats-secondary w-full max-w-sm text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold text-neats-primary mb-2">Scan & Go Ticket</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-600 mb-4">Enter your ID to generate a unique ticket code for mess entry.</p>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input id="qr-user-id-input" type="text" placeholder="Enter your ID"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="border border-gray-300 p-2 rounded w-full mb-3 focus:outline-none focus:ring-2 focus:ring-neats-secondary">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="qr-generate-btn"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="bg-neats-primary text-white px-4 py-2 rounded w-full hover:bg-neats-primary/90 transition shadow-lg hover:shadow-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Generate QR Code
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
                    
                    <button id="qr-back-to-home-btn" class="mt-3 text-gray-600 px-4 py-2 rounded w-full hover:underline transition">
                        â† Back to Home
                    </button>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="qr-message" class="mt-4 text-gray-800 font-medium hidden"></div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="qrcode-container-scan" class="mt-4 flex justify-center hidden"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </section>
            
            Â  Â  Â  Â  Â  Â  <section id="user-info-tab" class="tab-content hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-4xl font-bold text-neats-primary mb-8 border-b-4 border-neats-secondary pb-3">My Identity and Details</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-neats-secondary/10 p-8 rounded-3xl shadow-xl flex flex-col md:flex-row items-start md:items-center justify-between space-y-4 md:space-y-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-lg font-semibold text-gray-700">Your Unique Mess ID:</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="user-id-display" class="text-3xl md:text-4xl font-mono font-extrabold text-neats-primary break-all bg-white px-3 py-1 rounded-lg">Loading...</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="copy-btn" onclick="copyUserId()" class="flex items-center p-3 bg-neats-primary text-white rounded-full transition-all duration-200 shadow-md hover:shadow-lg hover:scale-110 active:bg-neats-secondary">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="copy" class="w-5 h-5 mr-2"></i> Copy ID
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-10 p-6 bg-gray-50 rounded-2xl shadow-md border-l-4 border-gray-400">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-bold text-gray-800 mb-3 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="shield-check" class="w-6 h-6 mr-2 text-neats-primary"></i> Account Status
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-600">You are securely logged in. This unique ID ensures only you can claim your reservations.</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </section>

Â  Â  Â  Â  Â  Â  <section id="menu-tab" class="tab-content hidden">
Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-4xl font-bold text-neats-primary mb-8 border-b-4 border-neats-secondary pb-3">ğŸ½ï¸ Weekly Menu Schedule!</h2>
Â  Â  Â  Â  Â  Â  Â  Â  <div id="menu-container" class="space-y-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-center text-gray-500 p-8 bg-gray-100 rounded-xl shadow-inner">Fetching weekly meals...</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-10 text-center p-5 bg-neats-secondary/20 rounded-2xl shadow-inner">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-neats-secondary font-semibold flex items-center justify-center text-lg">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="sparkles" class="w-6 h-6 mr-2"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Special of the week: Variety is the spice of life!
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </section>

            <section id="reserve-tab" class="tab-content hidden">
                <h2 class="text-4xl font-bold text-neats-primary mb-8 border-b-4 border-neats-secondary pb-4">ğŸŸï¸ Reserve Your Meal Ticket</h2>
                <div class="bg-neats-primary/10 p-8 rounded-3xl shadow-2xl mb-10">
                    <h3 class="text-2xl font-semibold text-neats-primary mb-6 flex items-center">
                        <i data-lucide="shopping-cart" class="w-7 h-7 mr-3"></i> Ready to Book Today?
                    </h3>
                    <div class="flex flex-col space-y-6">
                        <!-- Time-based sections -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                            <!-- Breakfast Section -->
                            <div class="bg-white p-6 rounded-2xl shadow-md border-t-4 border-neats-secondary">
                                <div class="flex items-center mb-4">
                                    <i data-lucide="coffee" class="w-6 h-6 text-neats-secondary mr-2"></i>
                                    <h4 class="text-lg font-bold text-gray-800">Breakfast</h4>
                                </div>
                                <div id="breakfast-options" class="space-y-3">
                                    <!-- Breakfast items will be populated here -->
                                </div>
                            </div>

                            <!-- Lunch Section -->
                            <div class="bg-white p-6 rounded-2xl shadow-md border-t-4 border-neats-primary">
                                <div class="flex items-center mb-4">
                                    <i data-lucide="sun" class="w-6 h-6 text-neats-primary mr-2"></i>
                                    <h4 class="text-lg font-bold text-gray-800">Lunch</h4>
                                </div>
                                <div id="lunch-options" class="space-y-3">
                                    <!-- Lunch items will be populated here -->
                                </div>
                            </div>

                            <!-- Snacks Section -->
                            <div class="bg-white p-6 rounded-2xl shadow-md border-t-4 border-neats-secondary">
                                <div class="flex items-center mb-4">
                                    <i data-lucide="cookie" class="w-6 h-6 text-neats-secondary mr-2"></i>
                                    <h4 class="text-lg font-bold text-gray-800">Snacks</h4>
                                </div>
                                <div id="snacks-options" class="space-y-3">
                                    <!-- Snacks items will be populated here -->
                                </div>
                            </div>

                            <!-- Dinner Section -->
                            <div class="bg-white p-6 rounded-2xl shadow-md border-t-4 border-neats-primary">
                                <div class="flex items-center mb-4">
                                    <i data-lucide="moon" class="w-6 h-6 text-neats-primary mr-2"></i>
                                    <h4 class="text-lg font-bold text-gray-800">Dinner</h4>
                                </div>
                                <div id="dinner-options" class="space-y-3">
                                    <!-- Dinner items will be populated here -->
                                </div>
                            </div>
                        </div>

                        <!-- Loading Message -->
                        <div id="reservation-options" class="hidden">
                            <p class="text-gray-600 text-center py-6 bg-white/50 rounded-xl">Today's menu options loading...</p>
                        </div>

                        <!-- Reserve Message -->
                        <div id="reserve-message" class="text-center font-medium text-sm bg-white/50 rounded-xl p-4"></div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-3xl shadow-lg border-l-4 border-neats-primary">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                        <i data-lucide="check-circle" class="w-7 h-7 mr-3 text-neats-primary"></i> 
                        Your Active Reservations
                    </h3>
                    <div id="active-reservations-container" class="space-y-4">
                        <p class="text-gray-500 text-center p-6 bg-gray-50 rounded-xl border-dashed border-2 border-neats-primary/30">
                            No active reservations found for today. Get reserving!
                        </p>
                    </div>
                </div>
            </section>Â  Â  Â  Â  Â  Â  <div id="custom-modal" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center hidden p-4 transition-opacity duration-300">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="modal-content" class="bg-white p-8 rounded-2xl shadow-2xl max-w-sm w-full transform transition-all duration-200 border-t-8 border-neats-primary scale-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 id="modal-title" class="text-2xl font-bold text-neats-primary mb-3"></h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p id="modal-body" class="text-gray-700 mb-6"></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="modal-close-btn" class="w-full bg-neats-primary text-white font-semibold py-3 rounded-xl hover:bg-neats-primary/80 transition-colors shadow-lg hover:shadow-xl hover:scale-[1.01]">Close</button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </main>

Â  Â  </div>

Â  Â  <script type="module">
Â  Â  Â  Â  // Import only what is necessary for the local fallback logic
Â  Â  Â  Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
Â  Â  Â  Â  import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
Â  Â  Â  Â  import { getFirestore, doc, setDoc, onSnapshot, collection, query, where, serverTimestamp, runTransaction, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

Â  Â  Â  Â  // Global Firebase Variables (Mandatory Canvas/Runtime variables)
Â  Â  Â  Â  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
Â  Â  Â  Â  const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
Â  Â  Â  Â  const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

Â  Â  Â  Â  // --- LOCAL FALLBACK DATA (For VS Code/Offline use) ---
Â  Â  Â  Â  const defaultWeeklyMenu = [
Â  Â  Â  Â  Â  Â  { day: 'Sunday', meals: [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'su-b', type: 'Breakfast', item: 'Omelette/Pancake', price: 55, icon: 'coffee' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'su-l', type: 'Lunch', item: 'Full Feast: 3 Curries, Dessert', price: 120, icon: 'sun' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'su-s', type: 'Snacks', item: 'Fruit Chat', price: 40, icon: 'cookie' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'su-d', type: 'Dinner', item: 'Leftovers & Light Meal', price: 60, icon: 'moon' }
Â  Â  Â  Â  Â  Â  ]},
Â  Â  Â  Â  Â  Â  { day: 'Monday', meals: [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'm-b', type: 'Breakfast', item: 'Poha & Jalebi', price: 40, icon: 'coffee' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'm-l', type: 'Lunch', item: 'Dal Tadka, Mix Veg, 4 Roti', price: 70, icon: 'sun' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'm-s', type: 'Snacks', item: 'Samosa & Tea', price: 30, icon: 'cookie' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'm-d', type: 'Dinner', item: 'Aloo Gobi, Raita, 4 Roti', price: 70, icon: 'moon' }
Â  Â  Â  Â  Â  Â  ]},
Â  Â  Â  Â  Â  Â  { day: 'Tuesday', meals: [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 't-b', type: 'Breakfast', item: 'Idli, Sambar, Chutney', price: 45, icon: 'coffee' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 't-l', type: 'Lunch', item: 'Rajma Chawal, Salad', price: 80, icon: 'sun' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 't-s', type: 'Snacks', item: 'Bread Butter & Milk', price: 25, icon: 'cookie' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 't-d', type: 'Dinner', item: 'Chicken/Paneer Curry, Rice', price: 110, icon: 'moon' }
Â  Â  Â  Â  Â  Â  ]},
Â  Â  Â  Â  Â  Â  { day: 'Wednesday', meals: [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'w-b', type: 'Breakfast', item: 'Aloo Paratha & Curd', price: 50, icon: 'coffee' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'w-l', type: 'Lunch', item: 'Chole Bhature, Onion', price: 85, icon: 'sun' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'w-s', type: 'Snacks', item: 'Maggi', price: 35, icon: 'cookie' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'w-d', type: 'Dinner', item: 'Veg Biryani, Gulab Jamun', price: 100, icon: 'moon' }
Â  Â  Â  Â  Â  Â  ]},
Â  Â  Â  Â  Â  Â  { day: 'Thursday', meals: [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'th-b', type: 'Breakfast', item: 'Dosa & Sambar', price: 45, icon: 'coffee' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'th-l', type: 'Lunch', item: 'Shahi Paneer, Pulao, Curd', price: 90, icon: 'sun' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'th-s', type: 'Snacks', item: 'Pakoda & Tea', price: 30, icon: 'cookie' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'th-d', type: 'Dinner', item: 'Kadhi Chawal, Pickle', price: 65, icon: 'moon' }
Â  Â  Â  Â  Â  Â  ]},
Â  Â  Â  Â  Â  Â  { day: 'Friday', meals: [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'f-b', type: 'Breakfast', item: 'Upma & Fruit', price: 35, icon: 'coffee' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'f-l', type: 'Lunch', item: 'Lemon Rice, Dal', price: 60, icon: 'sun' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'f-s', type: 'Snacks', item: 'Biscuits & Coffee', price: 20, icon: 'cookie' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'f-d', type: 'Dinner', item: 'Pizza Day (Hostel Special)', price: 150, icon: 'moon' }
Â  Â  Â  Â  Â  Â  ]},
Â  Â  Â  Â  Â  Â  { day: 'Saturday', meals: [
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'sa-b', type: 'Breakfast', item: 'Poori Bhaji', price: 40, icon: 'coffee' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'sa-l', type: 'Chinese Noodles & Manchurian', item: 'Chinese Noodles & Manchurian', price: 100, icon: 'sun' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'sa-s', type: 'Snacks', item: 'Vada Pav', price: 30, icon: 'cookie' },
Â  Â  Â  Â  Â  Â  Â  Â  { id: 'sa-d', type: 'Dinner', item: 'Special Thali', price: 130, icon: 'moon' }
Â  Â  Â  Â  Â  Â  ]},
Â  Â  Â  Â  ];
Â  Â  Â  Â  let localReservations = {}; // Local state for reservations
Â  Â  Â  Â  let localUserId = 'ANUPRIYA-NAHAK'; // Fixed user ID for local mode

Â  Â  Â  Â  let app;
Â  Â  Â  Â  let db;
Â  Â  Â  Â  let auth;
Â  Â  Â  Â  let userId = null;
Â  Â  Â  Â  let isAuthReady = false;
Â  Â  Â  Â  let isLocalMode = false; // New flag for local mode

Â  Â  Â  Â  // setLogLevel('debug'); // Disable debug logging by default in production code, enable only when needed

Â  Â  Â  Â  // Utility to display custom modal message with animation
Â  Â  Â  Â  const showModal = (title, body) => {
Â  Â  Â  Â  Â  Â  document.getElementById('modal-title').textContent = title;
Â  Â  Â  Â  Â  Â  document.getElementById('modal-body').innerHTML = body;
Â  Â  Â  Â  Â  Â  const modal = document.getElementById('custom-modal');
Â  Â  Â  Â  Â  Â  const content = document.getElementById('modal-content');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  modal.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  // Trigger animation
Â  Â  Â  Â  Â  Â  setTimeout(() => content.classList.replace('scale-0', 'scale-100'), 10);
Â  Â  Â  Â  };
Â  Â  Â  Â  document.getElementById('modal-close-btn').onclick = () => {
Â  Â  Â  Â  Â  Â  const modal = document.getElementById('custom-modal');
Â  Â  Â  Â  Â  Â  const content = document.getElementById('modal-content');

Â  Â  Â  Â  Â  Â  content.classList.replace('scale-100', 'scale-0');
Â  Â  Â  Â  Â  Â  // Hide modal after animation completes
Â  Â  Â  Â  Â  Â  setTimeout(() => modal.classList.add('hidden'), 200);
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- CORE FIREBASE INITIALIZATION AND AUTHENTICATION ---
Â  Â  Â  Â  const initFirebase = async () => {
Â  Â  Â  Â  Â  Â  document.getElementById('loading-spinner').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (!firebaseConfig) {
Â  Â  Â  Â  Â  Â  Â  Â  // --- Local/VS Code Mode Fallback ---
Â  Â  Â  Â  Â  Â  Â  Â  console.warn("Firebase configuration missing. Starting in LOCAL DEVELOPMENT MODE.");
Â  Â  Â  Â  Â  Â  Â  Â  isLocalMode = true;
Â  Â  Â  Â  Â  Â  Â  Â  userId = localUserId;
Â  Â  Â  Â  Â  Â  Â  Â  isAuthReady = true;
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('user-id-display').textContent = userId + ' (LOCAL)';
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Initialize local UI with default data
Â  Â  Â  Â  Â  Â  Â  Â  const today = new Date().toLocaleDateString('en-US', { weekday: 'long' });
Â  Â  Â  Â  Â  Â  Â  Â  const todayMenu = defaultWeeklyMenu.find(d => d.day === today)?.meals || [];

Â  Â  Â  Â  Â  Â  Â  Â  currentMenuMeals = todayMenu; // Only today's meals are reservable
Â  Â  Â  Â  Â  Â  Â  Â  renderMenu(defaultWeeklyMenu); // Render the full week's menu
Â  Â  Â  Â  Â  Â  Â  Â  renderReservationOptions(currentMenuMeals, []);
Â  Â  Â  Â  Â  Â  Â  Â  renderActiveReservations([]);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loading-spinner').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('error-message').textContent = 'Running in Local Mode. Data is NOT persistent.';
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('error-message').classList.remove('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  return; // Exit initialization
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // --- Original Firebase Initialization (only runs if config exists) ---
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  app = initializeApp(firebaseConfig);
Â  Â  Â  Â  Â  Â  Â  Â  db = getFirestore(app);
Â  Â  Â  Â  Â  Â  Â  Â  auth = getAuth(app);

Â  Â  Â  Â  Â  Â  Â  Â  await setPersistence(auth, browserLocalPersistence).catch((error) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Persistence setup failed, proceeding without it:", error);
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  // 1. Initial Authentication Logic
Â  Â  Â  Â  Â  Â  Â  Â  if (initialAuthToken) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await signInWithCustomToken(auth, initialAuthToken).catch(e => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.warn("Custom token sign-in failed, falling back to anonymous.", e);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return signInAnonymously(auth);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await signInAnonymously(auth);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // 2. Auth State Listener
Â  Â  Â  Â  Â  Â  Â  Â  onAuthStateChanged(auth, (user) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (user) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId = user.uid;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isAuthReady = true;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('user-id-display').textContent = userId;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("User authenticated. ID:", userId);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Start data listeners only after auth is confirmed
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setupMenuListener();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setupReservationsListener();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("No user signed in.");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId = null;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isAuthReady = false;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('user-id-display').textContent = 'Not Authenticated';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loading-spinner').classList.add('hidden');
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Firebase Initialization Error:", error);
Â  Â  Â  Â  Â  Â  Â  Â  showModal("Setup Failed", "Could not initialize the application. Check console for details.");
Â  Â  Â  Â  Â  Â  Â  Â  document.getElementById('loading-spinner').classList.add('hidden');
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };


Â  Â  Â  Â  // --- FIRESTORE / LOCAL UTILITIES ---

Â  Â  Â  Â  // Get today's date in YYYY-MM-DD format for document IDs
Â  Â  Â  Â  const getTodayDate = () => new Date().toISOString().split('T')[0];

Â  Â  Â  Â  // Public Data Path for Weekly Menu
Â  Â  Â  Â  const getMenuDocRef = () => doc(db, 'artifacts', appId, 'public', 'data', 'n_eats_menu', 'weekly_menu');

Â  Â  Â  Â  // Private Data Path for User Reservations (Only today's date is relevant for the document ID)
Â  Â  Â  Â  const getReservationsCollectionRef = () => collection(db, 'artifacts', appId, 'users', userId, 'n_eats_reservations');

Â  Â  Â  Â  // --- DATA LISTENERS ---

Â  Â  Â  Â  // Listen for the weekly menu
Â  Â  Â  Â  let currentMenuMeals = []; // Store only today's reservable meals globally
Â  Â  Â  Â  const setupMenuListener = () => {
Â  Â  Â  Â  Â  Â  if (isLocalMode) return; // Skip in local mode, using hardcoded data
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const menuRef = getMenuDocRef();
Â  Â  Â  Â  Â  Â  onSnapshot(menuRef, (docSnap) => {
Â  Â  Â  Â  Â  Â  Â  Â  const today = new Date().toLocaleDateString('en-US', { weekday: 'long' });

Â  Â  Â  Â  Â  Â  Â  Â  if (docSnap.exists() && docSnap.data().weeklyMeals) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const weeklyMenu = docSnap.data().weeklyMeals;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Find today's meals for reservation logic
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const todayMeals = weeklyMenu.find(d => d.day === today)?.meals || [];

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentMenuMeals = todayMeals; // CRITICAL: Only today's meals are reservable
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderMenu(weeklyMenu); // Render the FULL weekly menu
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Rerender reservation options when menu changes
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (userId) {Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const reservationsQuery = query(getReservationsCollectionRef(), where('reservationDate', '==', getTodayDate()));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  onSnapshot(reservationsQuery, (snapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const reservations = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  snapshot.forEach((doc) => reservations.push(doc.data()));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderReservationOptions(currentMenuMeals, reservations);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderReservationOptions(currentMenuMeals, []);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.log("No weekly menu found. Creating a default one...");
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  createDefaultMenu();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentMenuMeals = [];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderMenu([]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderReservationOptions([], []);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, (error) => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error fetching menu:", error);
Â  Â  Â  Â  Â  Â  Â  Â  showModal("Data Error", "Failed to load the weekly menu. Please try refreshing.");
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  // Listen for user's active reservations
Â  Â  Â  Â  const setupReservationsListener = () => {
Â  Â  Â  Â  Â  Â  if (isLocalMode || !userId) return; // Skip in local mode

Â  Â  Â  Â  Â  Â  const reservationsQuery = query(getReservationsCollectionRef(), where('reservationDate', '==', getTodayDate()));
Â  Â  Â  Â  Â  Â  onSnapshot(reservationsQuery, (querySnapshot) => {
Â  Â  Â  Â  Â  Â  Â  Â  const reservations = [];
Â  Â  Â  Â  Â  Â  Â  Â  querySnapshot.forEach((doc) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reservations.push({ id: doc.id, ...doc.data() });
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  renderActiveReservations(reservations);
Â  Â  Â  Â  Â  Â  Â  Â  // Also update the options section if the menu is loaded
Â  Â  Â  Â  Â  Â  Â  Â  if (currentMenuMeals.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  renderReservationOptions(currentMenuMeals, reservations);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }, (error) => {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error fetching reservations:", error);
Â  Â  Â  Â  Â  Â  Â  Â  // Fail silently
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- DATA CREATION/UPDATE FUNCTIONS ---

Â  Â  Â  Â  // Create a default menu document if today's menu is missing (Only used in Firebase mode)
Â  Â  Â  Â  const createDefaultMenu = async () => {
Â  Â  Â  Â  Â  Â  const menuData = {
Â  Â  Â  Â  Â  Â  Â  Â  date: getTodayDate(),
Â  Â  Â  Â  Â  Â  Â  Â  weeklyMeals: defaultWeeklyMenu, // Store the entire structure
Â  Â  Â  Â  Â  Â  Â  Â  timestamp: serverTimestamp()
Â  Â  Â  Â  Â  Â  };

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  await setDoc(getMenuDocRef(), menuData);
Â  Â  Â  Â  Â  Â  Â  Â  console.log("Default weekly menu created successfully.");
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("Error creating default menu:", e);
Â  Â  Â  Â  Â  Â  Â  Â  showModal("Creation Failed", "Could not set up the default menu. Reservations may not work.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // Handle the reservation button click
Â  Â  Â  Â  window.handleReservation = async (mealId, mealType) => {
Â  Â  Â  Â  Â  Â  if (!isAuthReady) {
Â  Â  Â  Â  Â  Â  Â  Â  showModal("Authentication Required", "Please wait for authentication to complete before making a reservation.");
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const cardElement = document.getElementById(`card-${mealId}`);
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // --- Reservation logic switch for local vs firebase ---
Â  Â  Â  Â  Â  Â  if (isLocalMode) {
Â  Â  Â  Â  Â  Â  Â  Â  const today = getTodayDate();
Â  Â  Â  Â  Â  Â  Â  Â  if (!localReservations[today]) localReservations[today] = {};
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  let isCancelling = localReservations[today][mealId] && localReservations[today][mealId].isReserved;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (isCancelling) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localReservations[today][mealId] = { isReserved: false };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal("Reservation Canceled (LOCAL)", `Successfully canceled your ticket for **${mealType}**. (Not saved)`);
Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  localReservations[today][mealId] = { isReserved: true, mealId, mealType, reservationDate: today, timestamp: new Date() };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal("Reservation Success (LOCAL)!", `You have successfully reserved your ticket for **${mealType}**. (Not saved)`);
Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  // Simulate data update
Â  Â  Â  Â  Â  Â  Â  Â  const reservationsArray = Object.values(localReservations[today] || {});
Â  Â  Â  Â  Â  Â  Â  Â  renderActiveReservations(reservationsArray);
Â  Â  Â  Â  Â  Â  Â  Â  renderReservationOptions(currentMenuMeals, reservationsArray);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  // Original Firebase Transaction Logic
Â  Â  Â  Â  Â  Â  Â  Â  const reservationRef = doc(getReservationsCollectionRef(), mealId);
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await runTransaction(db, async (transaction) => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const docSnap = await transaction.get(reservationRef);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  let isCancelling = docSnap.exists() && docSnap.data().isReserved;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (isCancelling) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  transaction.update(reservationRef, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isReserved: false,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reservationDate: getTodayDate(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: serverTimestamp()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal("Reservation Canceled", `Successfully canceled your ticket for **${mealType}**.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  transaction.set(reservationRef, {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mealId: mealId,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  mealType: mealType,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reservationDate: getTodayDate(),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isReserved: true,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  timestamp: serverTimestamp()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal("Reservation Success!", `You have successfully reserved your ticket for **${mealType}**.`);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error("Reservation transaction failed:", e);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal("Reservation Failed", "An error occurred while processing your request. Please try again.");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  // --- FIX END ---

Â  Â  Â  Â  Â  Â  // Visual feedback: pulse the card
Â  Â  Â  Â  Â  Â  if (cardElement) {
Â  Â  Â  Â  Â  Â  Â  Â  cardElement.classList.add('animate-pop');
Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => cardElement.classList.remove('animate-pop'), 300);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };


Â  Â  Â  Â  // --- UI RENDERING FUNCTIONS ---

Â  Â  Â  Â  // Renders the full menu in the Food Menu tab
Â  Â  Â  Â  const renderMenu = (weeklyMenu) => {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('menu-container');
Â  Â  Â  Â  Â  Â  container.innerHTML = '';

Â  Â  Â  Â  Â  Â  if (weeklyMenu.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<p class="text-center text-gray-500 p-8 bg-gray-100 rounded-xl shadow-inner">No weekly menu published yet. Check back soon!</p>';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const mealIcons = {
Â  Â  Â  Â  Â  Â  Â  Â  'Breakfast': 'coffee',
Â  Â  Â  Â  Â  Â  Â  Â  'Lunch': 'sun',
Â  Â  Â  Â  Â  Â  Â  Â  'Snacks': 'cookie',
Â  Â  Â  Â  Â  Â  Â  Â  'Dinner': 'moon'
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Get today's day name to highlight the current day
Â  Â  Â  Â  Â  Â  const today = new Date().toLocaleDateString('en-US', { weekday: 'long' });

Â  Â  Â  Â  Â  Â  weeklyMenu.forEach(dayData => {
Â  Â  Â  Â  Â  Â  Â  Â  const isToday = dayData.day === today;
Â  Â  Â  Â  Â  Â  Â  Â  const dayClass = isToday ? 'bg-neats-primary/20 border-neats-primary shadow-xl scale-[1.005]' : 'bg-white border-gray-200 shadow-md';
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Start of the Day Card
Â  Â  Â  Â  Â  Â  Â  Â  let dayCard = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="rounded-2xl ${dayClass} transition-all duration-300 hover:shadow-2xl mb-6 p-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="text-2xl font-extrabold ${isToday ? 'text-neats-primary' : 'text-gray-800'} mb-4 border-b pb-2 flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="calendar-check" class="w-6 h-6 mr-2 ${isToday ? 'text-neats-primary' : 'text-neats-secondary'}"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${dayData.day} ${isToday ? ' (TODAY)' : ''}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-3">
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  dayData.meals.forEach(meal => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const iconName = mealIcons[meal.type] || 'utensils';
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dayCard += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center bg-gray-50 p-3 rounded-xl border-l-4 border-neats-secondary/50">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="${iconName}" class="w-6 h-6 text-neats-secondary mr-3 flex-shrink-0"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-grow">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-base font-bold text-gray-800">${meal.type}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-600">${meal.item}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-sm font-bold text-neats-primary bg-neats-primary/10 px-3 py-1 rounded-full flex-shrink-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  â‚¹${meal.price}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  dayCard += `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML += dayCard;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  lucide.createIcons();
Â  Â  Â  Â  };

Â  Â  Â  Â  // Renders the reservation cards in the Reserve tab (requires reservation data to show state)
Â  Â  Â  Â  const renderReservationOptions = (meals, reservations) => {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('reservation-options');
Â  Â  Â  Â  Â  Â  container.innerHTML = '';

Â  Â  Â  Â  Â  Â  if (meals.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<p class="text-gray-600 col-span-3">No menu available to reserve from for today. Check the Food Menu tab for the weekly schedule.</p>';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  const reservedMealIds = new Set(
Â  Â  Â  Â  Â  Â  Â  Â  reservations.filter(r => r.isReserved && (isLocalMode ? true : r.reservationDate === getTodayDate())).map(r => r.mealId)
Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  meals.forEach(meal => {
Â  Â  Â  Â  Â  Â  Â  Â  const isReserved = reservedMealIds.has(meal.id);
Â  Â  Â  Â  Â  Â  Â  Â  const buttonId = `reserve-btn-${meal.id}`;

Â  Â  Â  Â  Â  Â  Â  Â  const buttonClass = isReserved
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? 'bg-red-500 hover:bg-red-600 shadow-red-300/50'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : 'bg-neats-primary hover:bg-neats-primary/80 shadow-neats-primary/50';
Â  Â  Â  Â  Â  Â  Â  Â  const buttonText = isReserved
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? 'CANCEL Reservation'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : `Reserve (â‚¹${meal.price})`;
Â  Â  Â  Â  Â  Â  Â  Â  const cardBorder = isReserved
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? 'border-neats-primary shadow-2xl scale-[1.02]'
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : 'border-neats-secondary shadow-lg hover:shadow-xl hover:scale-[1.01]';

Â  Â  Â  Â  Â  Â  Â  Â  const card = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="card-${meal.id}" class="reservation-card bg-white p-4 rounded-xl transition-all duration-300 border-t-8 ${cardBorder}">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-xl font-bold text-gray-800 mb-1">${meal.type}</h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-sm text-gray-600 mb-3">${meal.item}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="${buttonId}" onclick="handleReservation('${meal.id}', '${meal.type}')" class="w-full text-white font-semibold py-2 rounded-lg transition-all duration-200 shadow-md ${buttonClass} hover:translate-y-[-1px] active:translate-y-[1px]">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${buttonText}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML += card;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  };

Â  Â  Â  Â  // Renders the user's active reservations
Â  Â  Â  Â  const renderActiveReservations = (reservations) => {
Â  Â  Â  Â  Â  Â  const container = document.getElementById('active-reservations-container');
Â  Â  Â  Â  Â  Â  container.innerHTML = '';
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  const activeReservations = isLocalMode 
Â  Â  Â  Â  Â  Â  Â  Â  ? reservations.filter(r => r.isReserved)
Â  Â  Â  Â  Â  Â  Â  Â  : reservations.filter(r => r.isReserved && r.reservationDate === getTodayDate());

Â  Â  Â  Â  Â  Â  if (activeReservations.length === 0) {
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML = '<p class="text-gray-500 text-center p-4 bg-gray-50 rounded-xl border-dashed border-2">No active reservations found for today. Get reserving!</p>';
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  activeReservations.forEach(reservation => {
Â  Â  Â  Â  Â  Â  Â  Â  // Find the corresponding meal details (item name, price)
Â  Â  Â  Â  Â  Â  Â  Â  const mealDetail = currentMenuMeals.find(m => m.id === reservation.mealId);
Â  Â  Â  Â  Â  Â  Â  Â  const mealItem = mealDetail ? mealDetail.item : 'Meal Item Unknown';
Â  Â  Â  Â  Â  Â  Â  Â  const mealPrice = mealDetail ? `(â‚¹${mealDetail.price})` : '';
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  // Use current Date object or convert Firestore timestamp
Â  Â  Â  Â  Â  Â  Â  Â  const bookingTime = isLocalMode 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ? new Date(reservation.timestamp).toLocaleTimeString()
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  : new Date(reservation.timestamp.toDate()).toLocaleTimeString();

Â  Â  Â  Â  Â  Â  Â  Â  const ticket = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-white p-5 rounded-xl shadow-lg border-l-8 border-neats-primary flex items-center justify-between transition-shadow hover:shadow-xl hover:scale-[1.01]">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h4 class="text-xl font-bold text-neats-primary flex items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="ticket" class="w-5 h-5 mr-2"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ${reservation.mealType} Ticket
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </h4>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-700 font-medium ml-7">${mealItem} <span class="text-neats-secondary">${mealPrice}</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-gray-500 text-xs ml-7 mt-1">Booked: ${bookingTime}</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-neats-primary font-extrabold text-2xl bg-neats-primary/10 p-3 rounded-full flex-shrink-0 animate-pop">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <i data-lucide="check-circle" class="w-6 h-6"></i>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  container.innerHTML += ticket;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  lucide.createIcons();
Â  Â  Â  Â  };

Â  Â  Â  Â  // --- SCAN & GO LOGIC ---
        const qrUserIdInput = document.getElementById('qr-user-id-input');
        const qrGenerateBtn = document.getElementById('qr-generate-btn');
        const qrMessage = document.getElementById('qr-message');
        const qrCodeContainerScan = document.getElementById('qrcode-container-scan');
        const scanGoCard = document.getElementById('scan-go-card');
        const qrBackToHomeBtn = document.getElementById('qr-back-to-home-btn');
        const zeroWasteCard = document.getElementById('zero-waste-card'); // NEW
        const zeroWasteBackBtn = document.getElementById('zero-waste-back-btn'); // NEW

        // QR Code Generation Handler (Based on your provided script)
        qrGenerateBtn.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  // Use the local ID if available and the input is empty
Â  Â  Â  Â  Â  Â  const inputId = qrUserIdInput.value.trim();
            const effectiveUserId = inputId || (isLocalMode ? localUserId : userId);

Â  Â  Â  Â  Â  Â  if (!effectiveUserId || effectiveUserId === 'Loading...' || effectiveUserId === 'Not Authenticated') {
Â  Â  Â  Â  Â  Â  Â  Â  showModal('Missing ID', 'Please enter your ID or wait for authentication to complete.');
Â  Â  Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  // Clear previous QR code
Â  Â  Â  Â  Â  Â  qrCodeContainerScan.innerHTML = "";
            qrCodeContainerScan.classList.add('hidden'); // Ensure it's hidden before generation

Â  Â  Â  Â  Â  Â  // Generate ticket code
Â  Â  Â  Â  Â  Â  const ticketCode = Math.random().toString(36).substring(2, 10).toUpperCase();
            const dateStr = new Date().toLocaleDateString();
Â  Â  Â  Â  Â  Â  const qrData = `N-Eats Ticket | ID: ${effectiveUserId} | Code: ${ticketCode} | Date: ${dateStr}`;

Â  Â  Â  Â  Â  Â  // Create QR Code
Â  Â  Â  Â  Â  Â  new QRCode(qrCodeContainerScan, {
Â  Â  Â  Â  Â  Â  Â  Â  text: qrData,
Â  Â  Â  Â  Â  Â  Â  Â  width: 200,
Â  Â  Â  Â  Â  Â  Â  Â  height: 200,
Â  Â  Â  Â  Â  Â  Â  Â  colorDark: "#000000",
Â  Â  Â  Â  Â  Â  Â  Â  colorLight: "#ffffff",
Â  Â  Â  Â  Â  Â  Â  Â  correctLevel: QRCode.CorrectLevel.H
Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  // Show message + QR code
Â  Â  Â  Â  Â  Â  qrMessage.textContent = "âœ… Here is your unique Mess Entry QR code:";
Â  Â  Â  Â  Â  Â  qrMessage.classList.remove('hidden');
Â  Â  Â  Â  Â  Â  qrCodeContainerScan.classList.remove('hidden');
            
            // Auto-populate the input with the generated ID for user clarity
            if (!inputId) {
                qrUserIdInput.value = effectiveUserId;
            }

Â  Â  Â  Â  Â  Â  console.log(`QR Generated: ID: ${effectiveUserId}, Ticket Code: ${ticketCode}`);
Â  Â  Â  Â  });
        
        // --- NAVIGATION LOGIC CONTINUED ---
Â  Â  Â  Â  const tabs = document.querySelectorAll('.tab-content');
Â  Â  Â  Â  const navButtons = document.querySelectorAll('.nav-button');
        const switchTab = (targetTab) => {
            // 1. Hide all tabs and deactivate all buttons
            tabs.forEach(tab => tab.classList.add('hidden'));
            navButtons.forEach(btn => {
                btn.classList.remove('active-tab', 'text-white', 'bg-neats-primary', 'shadow-neats-primary/40');
                btn.classList.add('text-gray-600', 'hover:bg-neats-secondary/20');
            });
            
            // 2. Show the target tab
            const targetElement = document.getElementById(`${targetTab}-tab`);
            if (targetElement) {
                targetElement.classList.remove('hidden');
            } else {
                console.error(`Target tab element not found: ${targetTab}-tab`);
                // Fallback to home if target tab is missing
                document.getElementById('home-tab').classList.remove('hidden');
                targetTab = 'home';
            }

            // 3. Activate the corresponding button (if one exists, ignore scan-go/zero-waste)
            if (targetTab !== 'scan-go' && targetTab !== 'zero-waste') {
                const activeButton = document.querySelector(`.nav-button[data-tab="${targetTab}"]`);
                if (activeButton) {
                    activeButton.classList.add('active-tab', 'text-white', 'bg-neats-primary', 'shadow-neats-primary/40', 'animate-pop');
                    activeButton.classList.remove('text-gray-600', 'hover:bg-neats-secondary/20');
                    setTimeout(() => activeButton.classList.remove('animate-pop'), 300);
                }
            }

            // 4. Re-render icons
            lucide.createIcons();
        };

Â  Â  Â  Â  navButtons.forEach(button => {
Â  Â  Â  Â  Â  Â  button.addEventListener('click', () => {
Â  Â  Â  Â  Â  Â  Â  Â  switchTab(button.getAttribute('data-tab'));
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  });

        // Click handler for the Scan & Go feature card
        scanGoCard.addEventListener('click', () => {
            switchTab('scan-go');
        });
        
        // Click handler for the Zero Waste feature card
        zeroWasteCard.addEventListener('click', () => {
            switchTab('zero-waste');
        });
        
        // Click handler for the Back to Home button in the QR tab
        qrBackToHomeBtn.addEventListener('click', () => {
            switchTab('home');
        });

        // Click handler for the Back to Home button in the Zero Waste tab
        zeroWasteBackBtn.addEventListener('click', () => {
            switchTab('home');
        });


Â  Â  Â  Â  // --- CLIPBOARD FUNCTIONALITY ---
Â  Â  Â  Â  window.copyUserId = () => {
Â  Â  Â  Â  Â  Â  const userIdText = document.getElementById('user-id-display').textContent;
Â  Â  Â  Â  Â  Â  const copyBtn = document.getElementById('copy-btn');
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (userIdText && userIdText !== 'Loading...' && userIdText !== 'Not Authenticated') {
Â  Â  Â  Â  Â  Â  Â  Â  const tempInput = document.createElement('textarea');
Â  Â  Â  Â  Â  Â  Â  Â  tempInput.value = userIdText;
Â  Â  Â  Â  Â  Â  Â  Â  document.body.appendChild(tempInput);
Â  Â  Â  Â  Â  Â  Â  Â  tempInput.select();
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  document.execCommand('copy');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal("Copied!", `Your unique **User ID** (${isLocalMode ? 'LOCAL' : 'CLOUD'}) has been copied to the clipboard.`);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Visual feedback on copy button
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyBtn.classList.add('animate-pop', 'bg-neats-secondary');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyBtn.classList.remove('animate-pop', 'bg-neats-secondary');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  copyBtn.classList.add('bg-neats-primary');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }, 300);

Â  Â  Â  Â  Â  Â  Â  Â  } catch (err) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  console.error('Copy failed:', err);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  showModal("Copy Failed", "Could not copy the ID. Please copy manually.");
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  document.body.removeChild(tempInput);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  showModal("Wait a moment", "The User ID is not yet ready to be copied.");
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  };

Â  Â  Â  Â  // Initialization
Â  Â  Â  Â  window.onload = () => {
Â  Â  Â  Â  Â  Â  Â  initFirebase();
Â  Â  Â  Â  Â  Â  Â  lucide.createIcons();
Â  Â  Â  Â  Â  Â  Â  // Ensure the initial tab is active with the new logic
Â  Â  Â  Â  Â  Â  Â  document.querySelector('.nav-button[data-tab="home"]').click(); 
Â  Â  Â  Â  }

Â  Â  </script>
</body>
</html>